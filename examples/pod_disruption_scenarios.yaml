# Pod Disruption Scenarios Configuration
# Requires environment variables for dynamic configuration
# Example usage:
# export version=4.19
# export scenario_type=pod_disruption_scenarios
# export cloud_infrastructure=AWS
# export cloud_type=self-managed
# export total_node_count=9
# export node_instance_type="*xlarge*"
# export network_plugins=OVNKubernetes
# export scenario_file="*pod_disruption_scenario.yaml"
# orion cmd --config examples/pod_disruption_scenarios.yaml --lookback 10d

metricsFile: metrics/chaos-scenarios-metrics.yaml
tests:
  - name: krkn-hub-*
    version_field: cluster_version
    uuid_field: run_uuid
    metadata:
      cluster_version: "{{ version }}"
      scenarios.scenario_type: "{{ scenario_type }}"
      cloud_infrastructure: "{{ cloud_infrastructure }}"
      cloud_type: "{{ cloud_type }}"
      total_node_count: "{{ total_node_count }}"
      network_plugins: "{{ network_plugins }}"
      scenarios.parameters.config.namespace_pattern.keyword: "{{ pod_namespace }}"
      scenarios.parameters.config.label_selector.keyword: "{{ label_selector }}"
    metrics:
      # Recovery & Health metrics
      - name: affected_pods_recovery
        threshold: 15
        direction: 1
        metricName.keyword: affected_pods_recovery
        metric_of_interest: total_recovery_time
        type: recovered
        agg:
          value: total_recovery_time
          agg_type: avg
      - name: affected_rescheduled
        threshold: 15
        direction: 1
        metricName.keyword: affected_pods_recovery
        metric_of_interest: pod_rescheduling_time
        type: recovered
        agg:
          value: pod_rescheduling_time
          agg_type: avg
      - name: affected_readiness
        threshold: 15
        direction: 1
        metricName.keyword: affected_pods_recovery
        metric_of_interest: pod_readiness_time
        type: recovered
        agg:
          value: pod_readiness_time
          agg_type: avg
